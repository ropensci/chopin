<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with chopin • chopin</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with chopin">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">chopin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01_start.html">Getting started with chopin</a></li>
    <li><a class="dropdown-item" href="../articles/v02_good_practice.html">Good practice of using `chopin`</a></li>
    <li><a class="dropdown-item" href="../articles/v03_par_pad_grid.html">Generate computational grids</a></li>
    <li><a class="dropdown-item" href="../articles/v04_climate_examples.html">Extracting Weather/Climate Geospatial Data with `chopin`</a></li>
    <li><a class="dropdown-item" href="../articles/v05_targets.html">targets and grid objects</a></li>
  </ul>
</li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NIEHS/chopin/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Getting started with chopin</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NIEHS/chopin/blob/main/vignettes/v01_start.Rmd" class="external-link"><code>vignettes/v01_start.Rmd</code></a></small>
      <div class="d-none name"><code>v01_start.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<ul>
<li>
<code>chopin</code> automatically distributes geospatial data
computation over multiple threads.</li>
<li>Function centered workflow will streamline the process of
parallelizing geospatial computation with minimal effort.</li>
</ul>
</div>
<div class="section level2">
<h2 id="chopin-workflow">
<code>chopin</code> workflow<a class="anchor" aria-label="anchor" href="#chopin-workflow"></a>
</h2>
<ul>
<li>The simplest way of parallelizing generic geospatial computation is
to start from <code>par_pad_*</code> functions to <code>par_grid</code>,
or running <code>par_hierarchy</code>, or <code>par_multirasters</code>
functions at once.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NIEHS/chopin" class="external-link">chopin</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sebkrantz.github.io/collapse/" class="external-link">collapse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.mirai.futureverse.org" class="external-link">future.mirai</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<ul>
<li>North Carolinian counties and a raster of elevation data are used as
example data.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nccnty_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"nc_hierarchy.gpkg"</span>, package <span class="op">=</span> <span class="st">"chopin"</span><span class="op">)</span></span>
<span><span class="va">ncelev_path</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/nc_srtm15_otm.tif"</span>, package <span class="op">=</span> <span class="st">"chopin"</span><span class="op">)</span></span>
<span><span class="va">nccnty</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">nccnty_path</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ncelev</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ncelev_path</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="generating-random-points-in-north-carolina">Generating random points in North Carolina<a class="anchor" aria-label="anchor" href="#generating-random-points-in-north-carolina"></a>
</h3>
<ul>
<li>To demonstrate chopin functions, we generate 10,000 random points in
North Carolina</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncsamp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/sample.html" class="external-link">spatSample</a></span><span class="op">(</span></span>
<span>    <span class="va">nccnty</span>,</span>
<span>    <span class="fl">1e4L</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">ncsamp</span><span class="op">$</span><span class="va">pid</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ncsamp</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="creating-grids">Creating grids<a class="anchor" aria-label="anchor" href="#creating-grids"></a>
</h2>
<ul>
<li>The example below will generate a regular grid from the random point
data.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncgrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/par_pad_grid.html">par_pad_grid</a></span><span class="op">(</span><span class="va">ncsamp</span>, mode <span class="op">=</span> <span class="st">"grid"</span>, nx <span class="op">=</span> <span class="fl">4L</span>, ny <span class="op">=</span> <span class="fl">2L</span>, padding <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ncgrid</span><span class="op">$</span><span class="va">original</span><span class="op">)</span></span></code></pre></div>
<p><img src="v01_start_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="extracting-values-from-raster">Extracting values from raster<a class="anchor" aria-label="anchor" href="#extracting-values-from-raster"></a>
</h2>
<ul>
<li>Since all <code>par_*</code> functions operate on
<code>future</code> backends, users should define the future plan before
running the functions. <code>multicore</code> plan supports
<code>terra</code> objects which may lead to faster computation, but it
is not supported in Windows. An alternative is
<code>future.mirai</code>’s <code>mirai_multisession</code> plan, which
is supported in many platforms and generally faster than plain future
multisession plan.</li>
<li>
<code>workers</code> argument should be defined with an integer
value to specify the number of threads to be used.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.mirai</span><span class="fu">::</span><span class="va"><a href="https://future.mirai.futureverse.org/reference/mirai_multisession.html" class="external-link">mirai_multisession</a></span>, workers <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Then we dispatch multiple <code>extract_at</code> runs on the grid
polygons.</li>
<li>Before we proceed, the terra object should be converted to sf
object.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/par_grid.html">par_grid</a></span><span class="op">(</span></span>
<span>    grids <span class="op">=</span> <span class="va">ncgrid</span>,</span>
<span>    pad_y <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    .debug <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    fun_dist <span class="op">=</span> <span class="va">extract_at</span>,</span>
<span>    x <span class="op">=</span> <span class="va">ncelev_path</span>,</span>
<span>    y <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">ncsamp</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"pid"</span>,</span>
<span>    radius <span class="op">=</span> <span class="fl">1e4</span>,</span>
<span>    func <span class="op">=</span> <span class="st">"mean"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="hierarchical-processing">Hierarchical processing<a class="anchor" aria-label="anchor" href="#hierarchical-processing"></a>
</h2>
<ul>
<li>Here we demonstrate hierarchical processing of the random points
using census tract polygons.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nccnty</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">nccnty_path</span>, layer <span class="op">=</span> <span class="st">"county"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `county' from data source </span></span>
<span><span class="co">##   `/home/runner/work/_temp/Library/chopin/extdata/nc_hierarchy.gpkg' </span></span>
<span><span class="co">##   using driver `GPKG'</span></span>
<span><span class="co">## Simple feature collection with 100 features and 1 field</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 1054155 ymin: 1341756 xmax: 1838923 ymax: 1690176</span></span>
<span><span class="co">## Projected CRS: NAD83 / Conus Albers</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nctrct</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">nccnty_path</span>, layer <span class="op">=</span> <span class="st">"tracts"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `tracts' from data source </span></span>
<span><span class="co">##   `/home/runner/work/_temp/Library/chopin/extdata/nc_hierarchy.gpkg' </span></span>
<span><span class="co">##   using driver `GPKG'</span></span>
<span><span class="co">## Simple feature collection with 2672 features and 1 field</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 1054155 ymin: 1341756 xmax: 1838923 ymax: 1690176</span></span>
<span><span class="co">## Projected CRS: NAD83 / Conus Albers</span></span></code></pre>
<ul>
<li>The example below will parallelize summarizing mean elevation at 10
kilometers circular buffers of random sample points by the first five
characters of census tract unique identifiers, which are county
codes.</li>
<li>This example demonstrates the hierarchy can be defined from any
given polygons if the unique identifiers are suitably formatted for
defining the hierarchy.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">px</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/par_hierarchy.html">par_hierarchy</a></span><span class="op">(</span></span>
<span>    <span class="co"># from here the par_hierarchy-specific arguments</span></span>
<span>    regions <span class="op">=</span> <span class="va">nctrct</span>,</span>
<span>    regions_id <span class="op">=</span> <span class="st">"GEOID"</span>,</span>
<span>    length_left <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    pad <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>    pad_y <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    .debug <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="co"># from here are the dispatched function definition</span></span>
<span>    <span class="co"># for parallel workers</span></span>
<span>    fun_dist <span class="op">=</span> <span class="va">extract_at</span>,</span>
<span>    <span class="co"># below should follow the arguments of the dispatched function</span></span>
<span>    x <span class="op">=</span> <span class="va">ncelev</span>,</span>
<span>    y <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">ncsamp</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"pid"</span>,</span>
<span>    radius <span class="op">=</span> <span class="fl">1e4</span>,</span>
<span>    func <span class="op">=</span> <span class="st">"mean"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">px</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 10000     2</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">px</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   pid      mean</span></span>
<span><span class="co">## 1  79 13.664886</span></span>
<span><span class="co">## 2 198  7.980108</span></span>
<span><span class="co">## 3 337 12.189816</span></span>
<span><span class="co">## 4 454  2.763836</span></span>
<span><span class="co">## 5 467 19.170189</span></span>
<span><span class="co">## 6 485 13.523435</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">px</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        pid      mean</span></span>
<span><span class="co">## 9995  9542 -1.184563</span></span>
<span><span class="co">## 9996  9703  5.548240</span></span>
<span><span class="co">## 9997  9756  5.548804</span></span>
<span><span class="co">## 9998  9759  6.540437</span></span>
<span><span class="co">## 9999  9841  6.414054</span></span>
<span><span class="co">## 10000 9963  4.990165</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="multiraster-processing">Multiraster processing<a class="anchor" aria-label="anchor" href="#multiraster-processing"></a>
</h2>
<ul>
<li>Here we demonstrate multiraster processing of the random points
using multiple rasters.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncelev</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/nc_srtm15_otm.tif"</span>, package <span class="op">=</span> <span class="st">"chopin"</span><span class="op">)</span></span>
<span><span class="va">ncelev</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ncelev</span><span class="op">)</span></span>
<span><span class="va">tdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span>check <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">ncelev</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test1.tif"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">ncelev</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test2.tif"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">ncelev</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test3.tif"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">ncelev</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test4.tif"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">ncelev</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test5.tif"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">tdir</span>, pattern <span class="op">=</span> <span class="st">"tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pm</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/par_multirasters.html">par_multirasters</a></span><span class="op">(</span></span>
<span>    filenames <span class="op">=</span> <span class="va">rasts</span>,</span>
<span>    fun_dist <span class="op">=</span> <span class="va">extract_at</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    y <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">ncsamp</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="op">]</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"pid"</span>,</span>
<span>    radius <span class="op">=</span> <span class="fl">1e4</span>,</span>
<span>    func <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>    .debug <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2500    2</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          mean               base_raster</span></span>
<span><span class="co">## 1   12.443567 /tmp/RtmpPCNl6g/test1.tif</span></span>
<span><span class="co">## 2   74.934341 /tmp/RtmpPCNl6g/test1.tif</span></span>
<span><span class="co">## 3  179.088806 /tmp/RtmpPCNl6g/test1.tif</span></span>
<span><span class="co">## 4    8.542515 /tmp/RtmpPCNl6g/test1.tif</span></span>
<span><span class="co">## 5 1087.089722 /tmp/RtmpPCNl6g/test1.tif</span></span>
<span><span class="co">## 6  110.032043 /tmp/RtmpPCNl6g/test1.tif</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">pm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            mean               base_raster</span></span>
<span><span class="co">## 2495 101.370438 /tmp/RtmpPCNl6g/test5.tif</span></span>
<span><span class="co">## 2496  -2.881788 /tmp/RtmpPCNl6g/test5.tif</span></span>
<span><span class="co">## 2497   7.347102 /tmp/RtmpPCNl6g/test5.tif</span></span>
<span><span class="co">## 2498   8.790645 /tmp/RtmpPCNl6g/test5.tif</span></span>
<span><span class="co">## 2499  21.443277 /tmp/RtmpPCNl6g/test5.tif</span></span>
<span><span class="co">## 2500  56.097313 /tmp/RtmpPCNl6g/test5.tif</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="caveats">Caveats<a class="anchor" aria-label="anchor" href="#caveats"></a>
</h2>
<div class="section level3">
<h3 id="why-parallelization-is-slower-than-the-ordinary-function-run">Why parallelization is slower than the ordinary function run?<a class="anchor" aria-label="anchor" href="#why-parallelization-is-slower-than-the-ordinary-function-run"></a>
</h3>
<ul>
<li>Parallelization may underperform when the datasets are too small to
take advantage of divide-and-compute approach, where parallelization
overhead is involved. Overhead here refers to the required amount of
computational resources for transferring objects to multiple
processes.</li>
<li>Since the demonstrations above use quite small datasets, the
advantage of parallelization was not as noticeable as it was expected.
Should a large amount of data (spatial/temporal resolution or number of
files, for example) be processed, users could find the efficiency of
this package. A vignette in this package demonstrates use cases
extracting various climate/weather datasets.</li>
</ul>
</div>
<div class="section level3">
<h3 id="notes-on-data-restrictions">Notes on data restrictions<a class="anchor" aria-label="anchor" href="#notes-on-data-restrictions"></a>
</h3>
<p><code>chopin</code> works best with <strong>two-dimensional</strong>
(<strong>planar</strong>) geometries. Users should disable
<code>s2</code> spherical geometry mode in <code>sf</code> by setting.
Running any <code>chopin</code> functions at spherical or
three-dimensional (e.g., including M/Z dimensions) geometries may
produce incorrect or unexpected results.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<!-- --- end of file --- -->
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Insang Song, Kyle Messier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
