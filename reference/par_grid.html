<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Parallelize spatial computation over the computational grids — par_grid • chopin</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parallelize spatial computation over the computational grids — par_grid"><meta name="description" content="future::multicore, future::multisession, future::cluster
future.mirai::mirai_multisession in future::plan will parallelize
the work in each grid. For details of the terminology in future package,
refer to future::plan. This function assumes that
users have one raster file and a sizable and spatially distributed
target locations. Each thread will process
the nearest integer of $|N_g| / |N_t|$ grids
where $|N_g|$ denotes the number of grids and $|N_t|$ denotes
the number of threads."><meta property="og:description" content="future::multicore, future::multisession, future::cluster
future.mirai::mirai_multisession in future::plan will parallelize
the work in each grid. For details of the terminology in future package,
refer to future::plan. This function assumes that
users have one raster file and a sizable and spatially distributed
target locations. Each thread will process
the nearest integer of $|N_g| / |N_t|$ grids
where $|N_g|$ denotes the number of grids and $|N_t|$ denotes
the number of threads."><meta property="og:image" content="https://NIEHS.github.io/chopin/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">chopin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/v01_start.html">Getting started with chopin</a></li>
    <li><a class="dropdown-item" href="../articles/v02_good_practice.html">Good practice of using `chopin`</a></li>
    <li><a class="dropdown-item" href="../articles/v03_par_pad_grid.html">Generate computational grids</a></li>
    <li><a class="dropdown-item" href="../articles/v04_climate_examples.html">Extracting Weather/Climate Geospatial Data with `chopin`</a></li>
    <li><a class="dropdown-item" href="../articles/v05_targets.html">targets and grid objects</a></li>
  </ul></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/NIEHS/chopin/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Parallelize spatial computation over the computational grids</h1>
      <small class="dont-index">Source: <a href="https://github.com/NIEHS/chopin/blob/main/R/scale_process.R" class="external-link"><code>R/scale_process.R</code></a></small>
      <div class="d-none name"><code>par_grid.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://future.futureverse.org/reference/multicore.html" class="external-link">future::multicore</a>, <a href="https://future.futureverse.org/reference/multisession.html" class="external-link">future::multisession</a>, <a href="https://future.futureverse.org/reference/cluster.html" class="external-link">future::cluster</a>
<a href="https://future.mirai.futureverse.org/reference/mirai_multisession.html" class="external-link">future.mirai::mirai_multisession</a> in <a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan</a> will parallelize
the work in each grid. For details of the terminology in <code>future</code> package,
refer to <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan</a></code>. This function assumes that
users have one raster file and a sizable and spatially distributed
target locations. Each thread will process
the nearest integer of $|N_g| / |N_t|$ grids
where $|N_g|$ denotes the number of grids and $|N_t|$ denotes
the number of threads.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">par_grid</span><span class="op">(</span><span class="va">grids</span>, <span class="va">fun_dist</span>, <span class="va">...</span>, pad_y <span class="op">=</span> <span class="cn">FALSE</span>, .debug <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-grids">grids<a class="anchor" aria-label="anchor" href="#arg-grids"></a></dt>
<dd><p>List of two sf/SpatVector objects. Computational grids.
It takes a strict assumption that the grid input is
an output of `par_pad_grid“.</p></dd>


<dt id="arg-fun-dist">fun_dist<a class="anchor" aria-label="anchor" href="#arg-fun-dist"></a></dt>
<dd><p><code>sf</code>, <code>terra</code> or <code>chopin</code> functions.
This function should have <code>x</code> and <code>y</code> arguments.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed to the argument <code>fun_dist</code>.</p></dd>


<dt id="arg-pad-y">pad_y<a class="anchor" aria-label="anchor" href="#arg-pad-y"></a></dt>
<dd><p>logical(1). Whether to filter y with the padded grid.
Should be TRUE when x is where the values are calculated.
Default is <code>FALSE</code>. In the reverse case, like <code>terra::extent</code> or
<code><a href="https://isciences.gitlab.io/exactextractr/reference/exact_extract.html" class="external-link">exactextractr::exact_extract</a></code>, the raster (x) extent should be set
with the padded grid.</p></dd>


<dt id="arg--debug">.debug<a class="anchor" aria-label="anchor" href="#arg--debug"></a></dt>
<dd><p>logical(1). Default is <code>FALSE</code>. Otherwise,
if a unit computation fails, the error message and the <code>CGRIDID</code>
value where the error occurred will be included in the output.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a data.frame object with computation results.
For entries of the results, consult the documentation of the function put
in <code>fun_dist</code> argument.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>In dynamic dots (<code>...</code>), <code>fun_dist</code> arguments should include
x and y where sf/terra class objects or file paths are accepted.
Virtually any sf/terra functions that accept two arguments
can be put in <code>fun_dist</code>, but please be advised that
some spatial operations do not necessarily give the
exact result from what would have been done single-thread.
For example, distance calculated through this function may return the
lower value than actual because the computational region was reduced.
This would be the case especially where the target features
are spatially sparsely distributed.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">future::multisession</a></code>, <code><a href="https://future.futureverse.org/reference/multicore.html" class="external-link">future::multicore</a></code>, <code><a href="https://future.futureverse.org/reference/cluster.html" class="external-link">future::cluster</a></code>,
<code><a href="https://future.mirai.futureverse.org/reference/mirai_multisession.html" class="external-link">future.mirai::mirai_multisession</a></code>, <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan</a></code>, <code><a href="par_map_args.html">par_map_args</a></code></p>
<p>Other Parallelization:
<code><a href="par_cut_coords.html">par_cut_coords</a>()</code>,
<code><a href="par_hierarchy.html">par_hierarchy</a>()</code>,
<code><a href="par_make_grid.html">par_make_grid</a>()</code>,
<code><a href="par_merge_grid.html">par_merge_grid</a>()</code>,
<code><a href="par_multirasters.html">par_multirasters</a>()</code>,
<code><a href="par_pad_balanced.html">par_pad_balanced</a>()</code>,
<code><a href="par_pad_grid.html">par_pad_grid</a>()</code>,
<code><a href="par_split_list.html">par_split_list</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Insang Song <a href="mailto:geoissong@gmail.com">geoissong@gmail.com</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.mirai.futureverse.org" class="external-link">future.mirai</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">mirai_multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ncpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ncpoly</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">ncpath</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reading layer `nc' from data source </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `/home/runner/work/_temp/Library/sf/shape/nc.shp' using driver `ESRI Shapefile'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 100 features and 14 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: MULTIPOLYGON</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geodetic CRS:  NAD27</span>
<span class="r-in"><span><span class="co"># sf object</span></span></span>
<span class="r-in"><span><span class="va">ncpnts</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/nc_random_point.rds"</span>, package <span class="op">=</span> <span class="st">"chopin"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># file path</span></span></span>
<span class="r-in"><span><span class="va">ncelev</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/nc_srtm15_otm.tif"</span>, package <span class="op">=</span> <span class="st">"chopin"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nccompreg</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="par_pad_grid.html">par_pad_grid</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    input <span class="op">=</span> <span class="va">ncpnts</span>,</span></span>
<span class="r-in"><span>    mode <span class="op">=</span> <span class="st">"grid"</span>,</span></span>
<span class="r-in"><span>    nx <span class="op">=</span> <span class="fl">4L</span>,</span></span>
<span class="r-in"><span>    ny <span class="op">=</span> <span class="fl">2L</span>,</span></span>
<span class="r-in"><span>    padding <span class="op">=</span> <span class="fl">5e3L</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Switch sf class to terra...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Switch terra class to sf...</span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">par_grid</span><span class="op">(</span></span></span>
<span class="r-in"><span>    grids <span class="op">=</span> <span class="va">nccompreg</span>,</span></span>
<span class="r-in"><span>    fun_dist <span class="op">=</span> <span class="va">extract_at</span>,</span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="va">ncelev</span>,</span></span>
<span class="r-in"><span>    y <span class="op">=</span> <span class="va">ncpnts</span>,</span></span>
<span class="r-in"><span>    qsegs <span class="op">=</span> <span class="fl">90L</span>,</span></span>
<span class="r-in"><span>    radius <span class="op">=</span> <span class="fl">5e3L</span>,</span></span>
<span class="r-in"><span>    id <span class="op">=</span> <span class="st">"pid"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Spherical geometry (s2) switched off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Input is not a character.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input is a character. Attempt to read it with terra::rast...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ℹ Task at CGRIDID: 1 is successfully dispatched.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input is a character. Attempt to read it with terra::rast...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ℹ Task at CGRIDID: 2 is successfully dispatched.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input is a character. Attempt to read it with terra::rast...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ℹ Task at CGRIDID: 3 is successfully dispatched.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input is a character. Attempt to read it with terra::rast...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ℹ Task at CGRIDID: 4 is successfully dispatched.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input is a character. Attempt to read it with terra::rast...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ℹ Task at CGRIDID: 5 is successfully dispatched.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input is a character. Attempt to read it with terra::rast...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ℹ Task at CGRIDID: 6 is successfully dispatched.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input is a character. Attempt to read it with terra::rast...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ℹ Task at CGRIDID: 7 is successfully dispatched.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input is a character. Attempt to read it with terra::rast...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ℹ Task at CGRIDID: 8 is successfully dispatched.</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Insang Song, Kyle Messier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

